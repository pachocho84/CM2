{% extends "CMBundle::layout.html.twig" %}

{% block body %}

    <h2>
        {#{{ image_tag('glyphicons/nameplatealt') }}#}
        {{ block('title') }}
    </h2>                                                           


     
    {#<ul class="breadcrumb">
      <li><?php echo link_to('Home', '@homepage') ?></li>
      <li><?php echo link_to(__('Account'), '@account') ?></li>
      <li class="active"><?php echo $sf_response->getTitle() ?></li>
    </ul>#}



    <div class="box">
        <div class="objects">
            {{ form_start(form) }}

                {{ form_row(form.imgFile) }}
                {{ form_row(form.imgOffset) }}
                {{ app.user.imgOffset }}
                {% if app.user.img is not null %}
                    <div class="alert alert-info"><i class="glyphicon glyphicon-exclamation-sign"></i> {{ 'Drag the image to adjust position.' | trans }}</div>
                    {{ show_img_box(asset(uploaded_images_full_dir ~ '/' ~ app.user.img), {'width': 150, 'height': 150, 'offset': app.user.imgOffset, 'box_attributes': {'id': 'profile-pic', 'style': 'border: 1px solid #bbbbbb; margin-bottom: 15px;'}}) | raw }}
                {% endif %}
            
                {{ form_row(form.coverImgFile) }}
                {{ form_row(form.coverImgOffset) }}
                {% if app.user.coverImg is not null %}
                    <div class="alert alert-info"><i class="glyphicon glyphicon-exclamation-sign"></i> {{ 'Drag the image to adjust position.' | trans }}</div>
                    {{ show_img_box(asset(uploaded_images_full_dir ~ '/' ~ app.user.coverImg), {'width': 570, 'height': 211, 'offset': app.user.coverImgOffset, 'box_attributes': {'id': 'cover-pic', 'style': 'border: 1px solid #bbbbbb; margin-bottom: 15px;' }}) | raw }}
                {% endif %}
            
            {{ form_end(form) }}
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">//<![CDATA[ 
        $(function(){   
            /* PROFILE & COVER PICTURE */
            function image_position(box, target, offset) {
                console.log(offset);
                box.css('cursor','move');
                box.find('.image_box-inner').draggable({
                    scroll: false,
                    drag: function(event, ui) {
                        console.log(ui.position.top, ui.position.left);
                        if (ui.position.top > offset[1]) {
                            ui.position.top = offset[1];
                        } else if (ui.position.top < box.height() + offset[1] - box.find('img').height()) {
                            ui.position.top = box.height() + offset[1] - box.find('img').height();
                        } 
                        if (ui.position.left > offset[0]) {
                            ui.position.left = offset[0];
                        } else if (ui.position.left < box.width() + offset[0] - box.find('img').width()) {
                            ui.position.left = box.width() + offset[0] - box.find('img').width();
                        } 
                    },
                    stop: function(event, ui) {
                        // console.log(box.width() + ' ' + box.find('box').width() + ' ' + box.height() + ' ' + box.find('box').height()); 
                        target.val(((Math.abs(ui.position.top) != 0 ? Math.abs(ui.position.top) : Math.abs(ui.position.left)) * 100 / box.height()).toFixed(2));   
                    }
                });  
            }
            if ($('#profile-pic').length == 1) {
                image_position($('#profile-pic'), $('#cm_cmbundle_user_image_imgOffset'), [$('#profile-pic .image_box-inner').position().left, -$('#profile-pic img').position().top]);
            }
            if ($('#cover-pic').length == 1) {
                image_position($('#cover-pic'), $('#cm_cmbundle_user_cover_image_imgOffset'), [$('#cover-pic .image_box-inner').position().left, -$('#cover-pic img').position().top]);
            }
        });//]]>  
    </script>
{% endblock %}

