{% extends "CMBundle::layout.html.twig" %}

{% block title %}{{ 'Profile & cover pictures'|trans }}{% endblock %}

{% block body %}

    <h3>{{ show_icon('Nameplatealt') }} <span>{{ block('title') }}</span></h3>                             


     
    {#<ul class="breadcrumb">
      <li><?php echo link_to('Home', '@homepage') ?></li>
      <li><?php echo link_to(__('Account'), '@account') ?></li>
      <li class="active"><?php echo $sf_response->getTitle() ?></li>
    </ul>#}



    <div class="box">
        <div class="objects">
            {{ form_start(form) }}

                {{ form_row(form.imgFile) }}
                {{ form_row(form.imgOffset, {'attr': {'img-offset-field': null}}) }}
                {% if user.img is not null %}
                    <div class="alert alert-info"><i class="glyphicon glyphicon-exclamation-sign"></i> {{ 'Drag the image to adjust position.' | trans }}</div>
                    {{ show_img_box(asset(uploaded_images_full_dir ~ '/' ~ user.img), {'width': 150, 'height': 150, 'offset': user.imgOffset, 'box_attributes': {'id': 'profile-pic', 'style': 'border: 1px solid #bbbbbb; margin-bottom: 15px;'}}) | raw }}
                {% endif %}
            
                {{ form_row(form.coverImgFile) }}
                {{ form_row(form.coverImgOffset, {'attr': {'cover-img-offset-field': null}}) }}
                {% if user.coverImg is not null %}
                    <div class="alert alert-info"><i class="glyphicon glyphicon-exclamation-sign"></i> {{ 'Drag the image to adjust position.' | trans }}</div>
                    {{ show_img_box(asset(uploaded_images_full_dir ~ '/' ~ user.coverImg), {'width': 570, 'height': 211, 'offset': user.coverImgOffset, 'box_attributes': {'id': 'cover-pic', 'style': 'border: 1px solid #bbbbbb; margin-bottom: 15px;' }}) | raw }}
                {% endif %}
            
            {{ form_end(form) }}
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">//<![CDATA[ 
        $(function(){   
            /* PROFILE & COVER PICTURE */
            function image_position(box, target, offset) {
                box.css('cursor', 'move');
                box.find('.image_box-inner').draggable({
                    scroll: false,
                    drag: function(event, ui) {
                        img = box.find('img');
                        if (ui.position.top > offset[1]) {
                            ui.position.top = offset[1];
                        } else if (ui.position.top < box.outerHeight() + offset[1] - img.height()) {
                            ui.position.top = box.outerHeight() + offset[1] - img.height();
                        } 
                        if (ui.position.left > offset[0]) {
                            ui.position.left = offset[0];
                        } else if (ui.position.left < box.outerWidth() + offset[0] - img.width()) {
                            ui.position.left = box.outerWidth() + offset[0] - img.width();
                        }
                    },
                    stop: function(event, ui) {
                        offsetX = Math.abs(100 * (offset[0] - ui.position.left) / box.find('img').outerWidth());
                        offsetY = Math.abs(100 * (offset[1] - ui.position.top) / box.find('img').outerHeight());
                        target.val(img.width() >= img.height() ? offsetX : offsetY);   
                    }
                });  
            }
            if ($('#profile-pic').length == 1) {
                image_position($('#profile-pic'), $('[img-offset-field]'), [$('#profile-pic .image_box-inner').position().left, -$('#profile-pic img').position().top]);
            }
            if ($('#cover-pic').length == 1) {
                image_position($('#cover-pic'), $('[cover-img-offset-field]'), [$('#cover-pic .image_box-inner').position().left, -$('#cover-pic img').position().top]);
            }
        });//]]>  
    </script>
{% endblock %}

