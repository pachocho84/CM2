<div class="btn-group ajax-link-target">

    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{ icon('Relation') }} {{ 'Request a relation'|trans }}</button>
    <ul class="dropdown-menu">
        <li class="dropdown-header">{{ 'Request a relation'|trans }}</li>
        <li class="divider"></li>

        {% for relationType in relationTypes if relationType.userId is null %}
            {% if relations is not null and relationType.id in relations|keys %}
                {% set relation = relations[relationType.id] %}
            {% else %}
                {% set relation = null %}
            {% endif %}

            <li>
                <a href="{{ path('request_add', {object: 'Relation', objectId: app.user.id, userId: user.id, type: relationType.inverseTypeId}) }}" class="ajax-link">
                    <span class="glyphicon glyphicon-{% if relation is null %}unchecked{% elseif relation.accepted == constant('CM\\CMBundle\\Entity\\Relation::ACCEPTED_NO') %}transfer{% elseif relation.accepted == constant('CM\\CMBundle\\Entity\\Relation::ACCEPTED_UNI') %}plus{% elseif relation.accepted == constant('CM\\CMBundle\\Entity\\Relation::ACCEPTED_BOTH') %}ok{% else %}cloud{% endif %}"></span>
                    {{ relationType|trans }}
                </a>
            </li>
        {% endfor %}

        {{ dump(requests)}}

    </ul>

</div>

{#
<div class="btn-group ajax-link-target">
    
    {% if relations is null %}
       
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{ icon('Relation') }} {{ 'Request a relation'|trans }}</button>
        <ul class="dropdown-menu">
            <li class="dropdown-header">{{ 'Request a relation'|trans }}</li>
            <li class="divider"></li>

            {% for relationType in relationTypes if relationType.userId is null %}
                <li><a href="{{ path('request_add', {'object': 'Relation', 'objectId': app.user.id, 'userId': user.id, 'type': relationType.inverseTypeId}) }}" class="ajax-link">{{ relationType|trans }}</a></li>
            {% endfor %}

            <li class="divider"></li>

            {% for relationType in relationTypes if relationType.userId is not null %}
                <li><a href="{{ path('request_add', {'object': 'Relation', 'objectId': app.user.id, 'userId': user.id, 'type': relationType.inverseTypeId}) }}" class="ajax-link">{{ relationType|trans }}</a></li>
            {% endfor %}
        </ul>

    {% elseif relation.accepted and inverse.accepted %}

        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{ icon('Relation') }} {{ 'inverse'|trans }}</button>
        <ul class="dropdown-menu">
            <li class="dropdown-header">{{ ('%user% is your ' ~ inverse)|trans({'%user%': user.firstName}) }}</li>
            <li class="divider"></li>
            <li><a href="{{ path('request_delete', {'id': request.id}) }}" class="ajax-link">{{ 'Cancel relation'|trans }}</a></li>
        </ul>

    {% elseif relation.accepted and not inverse.accepted %}

        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{ icon('Relation') }} {{ 'inverse'|trans }}</button>
        <ul class="dropdown-menu">
            <li class="dropdown-header">{{ ('You said %user% is your ' ~ inverse)|trans({'%user%': user.firstName}) }}</li>
            <li class="divider"></li>
            <li><a href="{{ path('request_delete', {'id': request.id}) }}" class="ajax-link">{{ 'Cancel relation'|trans }}</a></li>
        </ul>

    {% elseif not relation.accepted and inverse.accepted %}

        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{ icon('Relation') }} {{ 'relation'|trans }}</button>
        <ul class="dropdown-menu">
            <li class="dropdown-header">{{ ('%user% said you are *FIXME* ' ~ relation)|trans({'%user%': user.firstName}) }}</li>
            <li class="divider"></li>
            <li><a href="{{ path('request_update', {'choice': 'accept', 'id': request.id}) }}" class="ajax-link">{{ 'Accept'|trans }}</a></li>
            <li><a href="{{ path('request_delete', {'id': request.id}) }}" class="ajax-link">{{ 'Refuse'|trans }}</a></li>
        </ul>

    {% endif %}
</div>
#}